<script>
    if (sessionStorage.loginedAccount == null) {
        window.location = "index.html";
    }
    // window.lcoation="index.html";

</script>

<!DOCTYPE html>
<!-- saved from url=(0022) -->
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta charset="utf-8">
    <title>RADIUS</title>
    <title></title>
    <meta name="generator" content="Bootply">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="shortcut icon" href="http://bootply.com/bootstrap/img/favicon.ico">
    <link rel="apple-touch-icon" href="http://bootply.com/bootstrap/img/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://bootply.com/bootstrap/img/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://bootply.com/bootstrap/img/apple-touch-icon-114x114.png">
    <script type="text/javascript" src="./RADIUS_files/jquery.min.js"></script>

    <script src="./JS/bootstrap-slider.js" async="" type="text/javascript"></script>

    <script src="./RADIUS_files/quant.js" async="" type="text/javascript"></script>
    <script async="" src="./RADIUS_files/analytics.js"></script>
    <script type="text/javascript" src="http://www.amcharts.com/lib/3/amcharts.js"></script>
    <script type="text/javascript" src="http://www.amcharts.com/lib/3/serial.js"></script>
    <script type="text/javascript" src="http://www.amcharts.com/lib/3/themes/dark.js"></script>

    <script type="text/javascript" src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>
    <!-- CSS code from Bootply.com editor -->
    <link rel="stylesheet" href="./CSS/style.css"/>

    <link rel="stylesheet" href="./CSS/slider.css"/>

    <style>
        body {

            background: #CC6600;

        }

        .chartAsset {
            width: 100%;
            height: 150px;
            background: black;
            color: #ffffff;
        }

    </style>
    <script>
        var readingAlgo;
        var selectedUnit;
        var algoLists;

    </script>
    <style type="text/css"></style>
    <script>window["_GOOG_TRANS_EXT_VER"] = "1";</script>
</head>

<!-- HTML code from Bootply.com editor -->

<body>

<div class="navbar navbar-fixed-top header">

    <div class="col-md-12">
        <div class="navbar-header">

            <a href="#" class="navbar-brand">RADIUS</a>

            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse1">
                <i class="glyphicon glyphicon-search"></i>
            </button>

        </div>
        <div class="collapse navbar-collapse" id="navbar-collapse1">

            <div class="hidden-sm">
                <p class="navbar-text navbar-left ">
                    <span class="boldWords" id="userName"></span></p>

                <p class="navbar-text navbar-left"><span>Cash on Hand</span>
                    <span class="boldWords" id="cashOnHand">N/A</span></p>

                <p class="navbar-text navbar-left"><a href="#" role="button" data-toggle="modal"
                                                      onclick="loadPortfolio('SIM0001')"> <span>My Algo</span>
                </a></p>

            </div>
            <ul class="nav navbar-nav navbar-right">

                <li><a href="#" id="btnToggle"><i class="glyphicon glyphicon-th-large"></i></a></li>
            </ul>
        </div>
    </div>
</div>
<div class=" navbar-default">


    <ul class="nav  nav-justified">

        <li class="active"><a href="Futures_sim.html">AlgoStore(Sim.)</a></li>
        <li><a href="powerTool_Sim.html">PowerTool(Sim.)</a></li>
        <li><a href="../public_html_admin/ranking.htm">Algo Ranking </a></li>


    </ul>

</div>


<div class="navbar navbar-default2" id="subnav2">


    <div class="col-xs-12 col-sm-6 col-md-6">
        <ul class="nav navbar-nav navbar-left ">
            <li class="active"><a href="Futures_sim.html">Futures</a></li>

        </ul>
    </div>


    <div class="col-xs-12 col-sm-6 col-md-6">

        <div class="col-xs-3 col-sm-3col-md-3">
            <div class="btn-group btn-input clearfix sort">
                <button type="button" class="btn btn-sm btn-default dropdown-toggle form-control  "
                        data-toggle="dropdown">
                    <span data-bind="label" id="pfmValue">Max.D.D</span> <span class="caret"></span>
                </button>
                <ul class="dropdown-menu buy" role="menu">
                    <li><a href="#">Max.D.D</a></li>
                    <li><a href="#">A.Return</a></li>
                    <li><a href="#">Sharpe Ratio</a></li>

                </ul>

            </div>

        </div>

        <div class="col-xs-3 col-sm-3col-md-3">
            <div class="btn-group btn-input clearfix sort">
                <button type="button" class="btn btn-default btn-sm dropdown-toggle form-control "
                        data-toggle="dropdown">
                    <span data-bind="label" id="orderType">Descending</span> <span class="caret"></span>
                </button>
                <ul class="dropdown-menu buy" role="menu">
                    <li><a href="#">Descending</a></li>
                    <li><a href="#">Ascending</a></li>


                </ul>

            </div>

        </div>

        <div class="col-xs-3 col-sm-3col-md-3">
            <div class="btn-group btn-input clearfix sort">
                <button type="button" class="btn btn-default btn-sm dropdown-toggle form-control "
                        data-toggle="dropdown">
                    <span data-bind="label" id="testType">BackTesting</span> <span class="caret"></span>
                </button>
                <ul class="dropdown-menu buy" role="menu">
                    <li><a href="#">BackTesting</a></li>
                    <li><a href="#">L.T.D</a></li>

                </ul>

            </div>
        </div>


        <div class="col-xs-3 col-sm-3col-md-3">
            <button type="button" class="btn btn-info sort" onclick="orderBy()">Sort</button>

        </div>


    </div>


</div>


<!--main-->
<div class="container" id="main">


    <div id="cellContent">
        <div class="row" id="algoList">


        </div>


    </div>
</div>


</div>
<!--/col-->
</div>

</div>


<br>


<nav class="navbar navbar-default navbar-fixed-bottom" role="navigation" id="bottomNav">
    <div class="row">


        <div class="col-md-6">


        </div>

    </div>
</nav>
<!--/main-->


<!--login modal-->
<div id="loginModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h2 class="text-center"><img src="./RADIUS_files/photo(3).jpg" class="img-circle"><br>Login</h2>
            </div>
            <div class="modal-body">
                <form class="form col-md-12 center-block">
                    <div class="form-group">
                        <input type="text" class="form-control input-lg" placeholder="Email">
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control input-lg" placeholder="Password">
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary btn-lg btn-block">Sign In</button>
                        <span class="pull-right"><a href="#">Register</a></span><span><a href="#">Need help?</a></span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <div class="col-md-12">
                    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                </div>
            </div>
        </div>
    </div>
</div>


<!--BuySell modal-->
<div id="buySellModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <div class="row">
                    <div class="col-xs-8 col-md-8">
                        <h2 class="text-center" id='algoName'>海龜交易法則2月100萬</h2>
                    </div>


                    <div class="col-xs-4 col-md-4">

                        <div class="btn-group btn-input clearfix">
                            <button type="button" class="btn btn-default dropdown-toggle form-control"
                                    data-toggle="dropdown">
                                <span data-bind="label">選購</span> <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu buy" role="menu" id="uumber">
                                <li><a href="#">1</a></li>
                                <li><a href="#">2</a></li>
                                <li><a href="#">3</a></li>
                                <li><a href="#">4</a></li>
                                <li><a href="#">5</a></li>

                                <li><a href="#">6</a></li>

                                <li><a href="#">7</a></li>
                                <li><a href="#">8</a></li>
                                <li><a href="#">9</a></li>
                                <li><a href="#">10</a></li>


                            </ul>

                        </div>
                        <button type="button" class="btn btn-danger" onclick='subscription()'>確認下單</button>

                    </div>
                </div>
            </div>
            <div class="modal-body">

                <div class="row">

                    <div class="col-xs-6 col-md-6">
                        <span class="boldWords">Characteristic</span>

                    </div>
                    <div class="col-xs-6 col-md-6">
                        <span class="blueWords" id="Feature">低風險，高賠率</span>

                    </div>

                </div>
                <div class="row">

                    <div class="col-xs-6 col-md-6">
                        <span class="boldWords">Background</span>

                    </div>
                    <div class="col-xs-6 col-md-6">
                        <span class="blueWords" id="Background">N/A</span>

                    </div>

                </div>
                <div class="row">

                    <hr>
                    <div class="col-xs-7 col-md-7">

                        <div id="chart_div5"></div>

                    </div>
                    <div class="col-xs-5 col-md-5">

                        <table class="table table-hover" style="background-color: white">
                            <tr>
                                <td class="active">Accumulated Period</td>
                                <td class="active">Performance of Algo</td>
                                <td class="active">Performance of HSI</td>
                            </tr>


                            <tr class="">
                                <td>1 month</td>
                                <td id="1mst">-7.0%</td>
                                <td id="1mhs">-3.3%</td>


                            </tr>

                            <tr class="info">
                                <td>3 months</td>
                                <td id="3mst">-7.0%</td>
                                <td id="3mhs">-3.3%</td>


                            </tr>

                            <tr class="">
                                <td>6 months</td>
                                <td id="6mst">-7.0%</td>
                                <td id="6mhs">-3.3%</td>


                            </tr>

                            <tr class="info">
                                <td>1 year</td>
                                <td id="1yst">-7.0%</td>
                                <td id="1yhs">-3.3%</td>


                            </tr>
                            <tr class="">
                                <td>2 years</td>
                                <td id="2yst">-7.0%</td>
                                <td id="2yhs">-3.3%</td>


                            </tr>
                            <tr class="info">
                                <td>5 years</td>
                                <td id="5yst">-7.0%</td>
                                <td id="5yhs">-3.3%</td>

                            </tr>


                        </table>
                    </div>
                </div>


            </div>
            <div class="modal-footer">


                <button class="btn" data-dismiss="modal" aria-hidden="true">OK</button>
            </div>
        </div>
    </div>
</div>

<!--about modal-->
<div id="aboutModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h2 class="text-center">About</h2>
            </div>
            <div class="modal-body">
                <div class="col-md-12 text-center">
                    <a href="http://bootply.com/90113">This Bootstrap Template</a><br>was made with <i
                        class="glyphicon glyphicon-heart"></i> by <a href="http://bootply.com/templates">Bootply</a>
                    <br><br>
                    <a href="https://github.com/iatek/bootstrap-google-plus">GitHub Fork</a>

                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">OK</button>
            </div>
        </div>
    </div>
</div>


<div id="compareTable" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h2 class="text-center">比較</h2>
            </div>
            <div class="modal-body">
                <table class="table table-hover" style="background-color: white">
                    <tr>
                        <td class="active">Asset Class</td>
                        <td class="active">Algo Name</td>
                        <td class="active">Annualized Return</td>
                        <td class="active">Max DD</td>
                        <td class="active">Sharp Ratio</td>
                    </tr>


                    <tr class="info">
                        <td>HK Equity</td>
                        <td>海龜交易法則2月１００萬</td>
                        <td>+35.5%</td>
                        <td>-12.5%</td>
                        <td>1.5</td>
                        <td><input type="text" class="span2 sl" value="0" data-slider-value="0" id="slb2">
                        </td>

                    </tr>

                    <tr class="info">
                        <td>HK Equity</td>
                        <td>海龜交易法則1月１００萬</td>
                        <td>+35.5%</td>
                        <td>-12.5%</td>
                        <td>1.5</td>
                        <td><input type="text" class="span2 sl" value="4" id="slb3">
                        </td>

                    </tr>

                    <tr class="info">
                        <td>HK Equity</td>
                        <td>海龜交易法則12月１００萬</td>
                        <td>+35.5%</td>
                        <td>-12.5%</td>
                        <td>1.5</td>
                        <td><input type="text" class="span2 sl" value="4" id="slb4">
                        </td>

                    </tr>


                </table>
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal" aria-hidden="true">OK</button>
            </div>
        </div>
    </div>
</div>


<div id="Portfolio" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h2 class="text-center">Profolio</h2>
            </div>
            <div class="modal-body">

                <div class="row">


                    <div class="col-xs-3 col-md-4">
                        <span>Cash on Hand</span>
                        <span class="boldWords" id="pfCashOnHand">N/A</span>
                    </div>
                    <div class="col-xs-3 col-md-4">
                        <span>Total Holding</span>
                        <span class="boldWords" id="pfTHold">N/A</span>


                    </div>

                    <div class="col-xs-3 col-md-4">
                        <span>Invested</span>
                        <span class="boldWords" id="pfInvested">N/A</span>
                    </div>


                </div>
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#algoTab" data-toggle="tab">Performance</a></li>

                </ul>

                <!-- Tab panes -->
                <div class="tab-content">
                    <div class="tab-pane active" id="algoTab">
                        <div id="piechart2"></div>
                        <table id='pTable' class="table table-hover" style="background-color: white"
                        　>
                        <tr>


                            <td class="active">Name</td>
                            <td class="active">Assets</td>
                            <td class="active">Unit</td>

                            <td class="active">Realized PNL</td>
                            <td class="active">Unrealized PNL</td>
                            <td class="active"></td>

                        </tr>


                        </table>

                    </div>
                    <div class="tab-pane" id="stockTab">
                        <table class="table table-hover" style="background-color: white">
                            <tr>


                                <td class="active">股票編號</td>
                                <td class="active">股票名稱</td>
                                <td class="active">平均買入價</td>
                                <td class="active">購買日期</td>
                                <td class="active">今日表現</td>
                                <td class="active">帳面盈虧</td>
                            </tr>


                            <tr class="">
                                <td>510</td>
                                <td>時富金融服務集團</td>
                                <td>0.095</td>

                                <td>14/10/2013</td>
                                <td>+0.04 +12.5%</td>
                                <td>+$1,000,000</td>

                            </tr>
                            <tr class="info">
                                <td>510</td>
                                <td>時富金融服務集團</td>
                                <td>0.095</td>

                                <td>14/10/2013</td>
                                <td>+0.04 +12.5%</td>
                                <td>+$1,000,000</td>


                            </tr>
                            <tr class="">
                                <td>510</td>
                                <td>時富金融服務集團</td>
                                <td>0.095</td>

                                <td>14/10/2013</td>
                                <td>+0.04 +12.5%</td>
                                <td>+$1,000,000</td>


                            </tr>


                        </table>
                    </div>
                    <div class="tab-pane" id="messages">...</div>
                    <div class="tab-pane" id="settings">...</div>
                </div>


            </div>


            <div class="modal-footer">
                <button class="btn" aria-hidden="true" onclick="updatePflo()">Refresh</button>

                <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- JavaScript jQuery code from Bootply.com editor -->


<script type="text/javascript">

    $(document).ready(function () {

        /* toggle layout */
        $('#btnToggle').click(function () {
            if ($(this).hasClass('on')) {
                /*
                 $('#main .col-md-6').addClass('col-md-4').removeClass('col-md-6');
                 $(this).removeClass('on');
                 */
                $('#cellContent').show();
                $('#tableContent').hide();

                $(this).removeClass('on');

            }
            else {
                $('#tableContent').show();

                $('#cellContent').hide();
                $(this).addClass('on');

                /*  $('#main .col-md-4').addClass('col-md-6').removeClass('col-md-4');
                 $(this).addClass('on');
                 */
            }
        });

        $('#tableContent').hide();

        getAlgoList(0, 0, 0);
        //window.sessionStorage.loginedAccount
        $('#userName').html(window.sessionStorage.loginedAccount);

        loadUserInfo();
    });

</script>


<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">

$('#sl1').slider({
    formater: function (value) {
        return '投資: ' + value + "單位";
    },
    value: 0
});


$('#sl2').slider({
    formater: function (value) {
        return '投資: ' + value + "單位";
    },
    value: 0
});

$('#sl3').slider({
    formater: function (value) {
        return '投資: ' + value + "單位";
    },
    value: 0
});

$('#sl4').slider({
    formater: function (value) {
        return '投資: ' + value + "單位";
    },
    value: 0
});

$('#slb2').slider({
    formater: function (value) {
        return '投資: ' + value + "單位";
    },
    value: 0
});

$('#slb3').slider({
    formater: function (value) {
        return '投資: ' + value + "單位";
    },
    value: 0
});

$('#slb4').slider({
    formater: function (value) {
        return '投資: ' + value + "單位";
    },
    value: 0
});

function Log() {

    // window.location.href = '#buySellModal';
    $('#buySellModal').modal('show');
}

function compareShow() {
    $('#bottomNav').show();

}


// $('#chart_div2').width(800);
console.log($('#chart_div2').width());
// $('#bottomNav').hide();
// $('#cellContent').hide();

$(document.body).on('click', '.dropdown-menu.buy li', function (event) {

    var $target = $(event.currentTarget);

    $target.closest('.btn-group')
            .find('[data-bind="label"]').text("" + $target.text() + "")
            .end()
            .children('.dropdown-toggle').dropdown('toggle');
    selectedUnit = $target.text();
    return false;

});


function subscription() {


    //  console.log('http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategySubscribe.aspx?account=SIM001&strategy=' + readingAlgo + '&subscribeunit=' + selectedUnit);

    /*
     $.ajax({
     url: 'http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategySubscribe.aspx?account=SIM001&strategy=' + readingAlgo + '&subscribeunit=' + selectedUnit,
     type: 'GET',
     data: {
     // user_name: $('#user_name').val()
     },
     error: function (xhr) {
     alert('Ajax request 發生錯誤');
     },
     success: function (response) {
     //  $('#msg_user_name').html(response);
     //  $('#msg_user_name').fadeIn();
     //  console.log(response);

     // quoteString = $(response.responseText).get(5).innerText;

     //    console.log(response);
     console.log(response.indexOf('S'));

     if (response.indexOf('S') == 0) {

     alert("購買成功!");

     }


     }


     });

     */
    $.ajax({
        url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
        type: 'GET',
        data: { actionName: "subscribeAlgo", token: "H2XLW3KSN52R34M", strategyid: readingAlgo, account: window.sessionStorage.loginedAccount, subscribeunit: selectedUnit},
        cache: false,
        dataType: "json",
        error: function (xhr) {
            alert('Ajax request 發生錯誤');
        },
        success: function (response) {
            //  $('#msg_user_name').html(response);
            //  $('#msg_user_name').fadeIn();
            //  console.log(response);

            // quoteString = $(response.responseText).get(5).innerText;

            console.log(response);
            console.log(response.indexOf('S'));

            if (response[0].isSuccess == 1) {

                alert("Order Suceessfully!");
                $('#buySellModal').modal('hide');

                orderBy();
            } else {

                alert('發生錯誤');

            }


        }
    });

    //loadAlgoList();


}


function loadAlgoList() {
    $.ajax({
        url: 'http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyList.aspx?strategytype=HKCOM',
        type: 'GET',
        data: {
            // user_name: $('#user_name').val()
        },
        error: function (xhr) {
            alert('Ajax request 發生錯誤');
        },
        success: function (response) {
            //  $('#msg_user_name').html(response);
            //  $('#msg_user_name').fadeIn();
            quoteString = $(response.responseText).get(5).innerText;

            console.log(quoteString);
            /*
             algoLists = quoteString.split("##");
             algo = algoLists[0].split("||");

             console.log('quoteString' + algo[5] + "/" + algo[3]);
             $('#unit_0').text(algo[5] + "/" + algo[3]);

             algo = algoLists[1].split("||");

             console.log('quoteString' + algo[5] + "/" + algo[3]);
             $('#unit_1').text(algo[5] + "/" + algo[3]);

             algo = algoLists[2].split("||");

             console.log('quoteString' + algo[5] + "/" + algo[3]);
             $('#unit_2').text(algo[5] + "/" + algo[3]);


             algo = algoLists[3].split("||");

             console.log('quoteString' + algo[5] + "/" + algo[3]);
             $('#unit_3').text(algo[5] + "/" + algo[3]);


             algo = algoLists[4].split("||");

             console.log('quoteString' + algo[5] + "/" + algo[3]);
             $('#unit_4').text(algo[5] + "/" + algo[3]);
             */
        }


    });


}


function loadStgPfm(strategyid) {
    $.ajax({
        url: 'http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyPerformance.aspx?strategyid=' + strategyid,
        type: 'GET',
        data: {
            // user_name: $('#user_name').val()
        },
        error: function (xhr) {
            alert('Ajax request 發生錯誤');
        },
        success: function (response) {
            //  $('#msg_user_name').html(response);
            //  $('#msg_user_name').fadeIn();
            quoteString = $(response.responseText).get(5).innerText;

            console.log(quoteString);


        }


    });


}


function loadUserPortfolio() {


    $.ajax({
        url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
        type: 'GET',
        data: { actionName: "getAlgoStrategyAccountPerformance", token: "H2XLW3KSN52R34M", account: window.sessionStorage.loginedAccount },
        cache: false,
        dataType: "json",
        success: function (result) {

            console.log(result);


            for (i = 0; i < result.length; i++) {
//Status: "Terminate""Active"
                if (result[i].Status = "Active") {



                    //onclick='unSubscribe('"+"PN012345"+",'"+pf[0]+"')'
                    $('#pTable tr:last').after("<tr class=''><td >" + result[i].StrategyName + "</td><td >Futures</td><td >" + result[i].SubscribeUnit + "</td><td >" + result[i].RealizedProfit + "</td><td >" + result[i].UnrealizedProfit + "</td><td ><button class='btn'  aria-hidden='true' onclick=\"unsubscribeAlgo('" + result[i].Strategy + "')\" >Cancel</button></td></tr>");
                    //   $('#pTable tr:last').after("<tr class=''><td >" + result[i].Strategy + "</td><td >香港恆生指數期貨</td><td >" + result[i].subscribeunit + "</td><td >" + result[i].RealizedProfit + "</td><td >" + result[i].UnrealizedProfit + "</td><td ><button class='btn'  aria-hidden='true' >Cancel</button></td></tr>");

                }
            }
            //  console.log(quoteString);
            $('#Portfolio').modal('show');

        }
    });


    /*

     $.ajax({
     url: 'http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyAccountPerformance.aspx?account=' + accountID,
     type: 'GET',
     data: {
     // user_name: $('#user_name').val()
     },
     error: function (xhr) {
     alert('Ajax request 發生錯誤');
     },
     success: function (response) {
     //  $('#msg_user_name').html(response);
     //  $('#msg_user_name').fadeIn();
     quoteString = $(response.responseText).get(5).innerText;
     pfList = quoteString.split("##");
     for (i = 0; i < pfList.length - 1; i++) {


     pf = pfList[i].split("||");

     name = '';
     if (pf[0] == 'PnB_S0') {
     name = '破井S0';
     }
     if (pf[0] == 'PnB_S1') {
     name = '破井S1';
     }
     if (pf[0] == 'PnB_S2') {
     name = '破井S2';
     }
     if (pf[0] == 'PnB_S3') {
     name = '破井S3';
     }
     if (pf[0] == '') {
     name = '任我行';
     }

     //onclick='unSubscribe('"+"PN012345"+",'"+pf[0]+"')'
     $('#pTable tr:last').after("<tr class=''><td >" + name + "</td><td >香港恆生指數期貨</td><td >1</td><td >" + pf[2] * 50 + "</td><td >" + pf[1] * 50 + "</td><td ><button class='btn'  aria-hidden='true' onclick=\"unSubscribe('" + "PN012345" + "','" + pf[0] + "')\" >Cancel</button></td></tr>");


     }
     console.log(quoteString);
     $('#Portfolio').modal('show');

     }

     });

     */
    //    getAlgoDetail('SIM0001');

}


function loadAlgoModal(stgid, strategy) {

    /*
     readingAlgo = stgid;
     if (stgid == '0') {
     $('#algoName').text('破井S0');

     }
     if (stgid == '1') {
     $('#algoName').text('破井S1');

     }
     if (stgid == '2') {
     $('#algoName').text('破井S2');

     }
     if (stgid == '3') {
     $('#algoName').text('破井S3');

     }
     if (stgid == '4') {
     $('#algoName').text('任我行');

     }
     */


}

function loadAlgoDetail(stg) {
    readingAlgo = stg;

    $.ajax({
        url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
        type: 'GET',
        data: { actionName: "getOnlyStrategyDetailInfo", strategy: stg, type: "0", token: "H2XLW3KSN52R34M" },
        cache: false,
        dataType: "json",
        success: function (result) {
            console.log(result[0]);
            //  algos = JSON.parse(result);

            $('#algoName').html(result[0].StrategyName);
            $('#Feature').html(result[0].Feature);
            $('#Background').html(result[0].Background);
            $('#1mst').html(roundNumberPercentage(result[0].HistoryReturn[0].ST));
            $('#1mhs').html(roundNumberPercentage(result[0].HistoryReturn[0].HS));

            $('#3mst').html(roundNumberPercentage(result[0].HistoryReturn[1].ST));

            $('#3mhs').html(roundNumberPercentage(result[0].HistoryReturn[1].HS));

            $('#6mst').html(roundNumberPercentage(result[0].HistoryReturn[2].ST));

            $('#6mhs').html(roundNumberPercentage(result[0].HistoryReturn[2].HS));


            $('#1yst').html(roundNumberPercentage(result[0].HistoryReturn[3].ST));

            $('#1yhs').html(roundNumberPercentage(result[0].HistoryReturn[3].HS));


            $('#2yst').html(roundNumberPercentage(result[0].HistoryReturn[4].ST));

            $('#2yhs').html(roundNumberPercentage(result[0].HistoryReturn[4].HS));
            $('#5yst').html(roundNumberPercentage(result[0].HistoryReturn[5].ST));

            $('#5yhs').html(roundNumberPercentage(result[0].HistoryReturn[5].HS));


            $('#buySellModal').modal('show');

        }
    });

}
$(document).ready(function () {
    console.log("ready!");
    //   loadAlgoList();


});


google.load("visualization", "1", {packages: ["corechart"]});
google.setOnLoadCallback(drawChart);
function drawChart() {


    var data2 = google.visualization.arrayToDataTable([
        ['Year', 'HS Index', 'Algo'],
        ['2004', 100, 100],
        ['2005', 120, 200],
        ['2006', 135, 300],
        ['2007', 145, 540]
    ]);

    var options3 = {
        title: 'Performance',
        legend: {position: 'bottom'}

        // width: 700, height: 300

    };

    var chart1 = new google.visualization.LineChart(document.getElementById('chart_div_0'));
    chart1.draw(data2, options3);

    var chart3 = new google.visualization.LineChart(document.getElementById('chart_div_1'));
    chart3.draw(data2, options3);

    var chart6 = new google.visualization.LineChart(document.getElementById('chart_div_2'));
    chart6.draw(data2, options3);

    var chart7 = new google.visualization.LineChart(document.getElementById('chart_div_3'));
    chart7.draw(data2, options3);

    var chart8 = new google.visualization.LineChart(document.getElementById('chart_div_4'));
    chart8.draw(data2, options3);


    var options4 = {
        title: 'Performance'
        // legend: {position: 'bottom'}

        // width: 700, height: 300

    };

    var chart4 = new google.visualization.LineChart(document.getElementById('chart_div5'));
    chart4.draw(data2, options4);


    var data = google.visualization.arrayToDataTable([
        ['Year', 'HS Index', 'Algo'],
        ['2004', 100, 100],
        ['2005', 120, 200],
        ['2006', 135, 300],
        ['2007', 145, 540]
    ]);

    var options = {
        title: 'Performance',
        legend: {position: 'bottom'}
    };

    var chart2 = new google.visualization.LineChart(document.getElementById('chart_div'));
    chart2.draw(data, options);
    //var chart3 = new google.visualization.LineChart(document.getElementById('chart_div2'));
    // chart3.draw(data, options);


    // $('#bottomNav').css({'z-index' : '-1'});
    //$('#bottomNav').zIndex=-1;


    var data4 = google.visualization.arrayToDataTable([
        ['Invested-Algo', '(%)'],
        ['海龜交易法則', 14],
        ['LLV趁低吸納', 2],
        ['LLV趁低吸納2', 2],
        ['MACD', 2]
    ]);

    var options = {
        title: 'Invested-Algo',
        width: 700, height: 300,
        is3D: true


    };

    var chart3 = new google.visualization.PieChart(document.getElementById('piechart'));
    chart3.draw(data4, options);


}

function loadPortfolio(accid) {


    var table = document.getElementById("pTable");

    for (var i = table.rows.length - 1; i > 0; i--) {
        table.deleteRow(i);
    }
//$('#pTable').remove();


    //console.log($("#pTable").text);

    //    myCreateFunction();


    loadUserPortfolio();

}


function myCreateFunction() {
    var table = document.getElementById("pTable");
    {
        var row = table.insertRow(0);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        cell1.innerHTML = "NEW CELL1";
        cell2.innerHTML = "NEW CELL2";
    }
}
function myDeleteFunction() {
    document.getElementById("myTable").deleteRow(0);
}


function cancelAlgo(stgID, unit) {

    var sub_algo;

    getAlgoDetail(window.sessionStorage.loginedAccount);


    console.log(sub_algo);

    $.ajax({
        url: 'http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyCancel?account=SIM0001&strategyid=' + stgID + '&unsubscribeunit=1' + strategyid,
        type: 'GET',
        data: {
            // user_name: $('#user_name').val()
        },
        error: function (xhr) {
            alert('Ajax request 發生錯誤');
        },
        success: function (response) {
            //  $('#msg_user_name').html(response);
            //  $('#msg_user_name').fadeIn();
            quoteString = $(response.responseText).get(5).innerText;

            console.log(quoteString);


        }


    });

    // http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyCancel.aspx?account=PN060006&strategyid=0&unsubscribeunit=1

}

// http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyUnsubscribe.aspx?account=PN060006&strategy=PnB_S0


function unSubscribe(account, stg) {

    console.log('unSubscribe');

    $.ajax({
        url: 'http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyUnsubscribe.aspx?account=' + account + '&strategy=' + stg,
        type: 'GET',
        data: {
            // user_name: $('#user_name').val()
        },
        error: function (xhr) {
            alert('Ajax request 發生錯誤');
        },
        success: function (response) {
            //  $('#msg_user_name').html(response);
            //  $('#msg_user_name').fadeIn();
            quoteString = $(response.responseText).get(5).innerText;

            console.log(quoteString);
            //  sub_algo = quoteString;

            if (quoteString.indexOf('S') == 0) {

                alert("取消成功!");

                var table = document.getElementById("pTable");

                for (var i = table.rows.length - 1; i > 0; i--) {
                    table.deleteRow(i);
                }
            }

        }


    });

    // http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyCancel.aspx?account=PN060006&strategyid=0&unsubscribeunit=1

}


function convertIDtoName(stgID) {

    if (stgID == '0') {
        return 'PnB_S0';

    }
    if (stgID == '1') {
        return 'PnB_S1';

    }
    if (stgID == '2') {
        return 'PnB_S2';

    }
    if (stgID == '3') {
        return 'PnB_S3';

    }
    if (stgID == '4') {
        return 'Random_Walk';

    }


}


function getAlgoList(category, orderby, performanceType) {


    console.log(category);

    console.log(performanceType);
    console.log(orderby);
    //http://stockgame.cashsns.com/RADIUS/getData.aspx?actionName=getOnlyStrategyDetailInfo&strategy=PriceBreakout_StaticTwo&type=0&token=H2XLW3KSN52R34M
    $.ajax({
        url: "http://stockgame.cashsns.com/RADIUS/getData.aspx?actionName=getStrategyAllInfoList&un=" + window.sessionStorage.loginedAccount + "&categroy=" + category + "&orderby=" + orderby + "&performanceType=" + performanceType + "&token=H2XLW3KSN52R34M",
        type: 'GET',
        //  data: {actionName: "getStrategyAllInfoList", token: "H2XLW3KSN52R34M", categroy: 2, orderby: orderby, performanceType: performanceType, un: "SIM001"},

        error: function (xhr) {
            //  alert('Ajax request 發生錯誤');
            console.log(xhr);
        },
        success: function (result) {
            algos = JSON.parse(result);
            //   algos=result;
            console.log(algos);
            //  algos=$(result.responseText).get(5).innerText;


            for (i = 0; i < algos.length; i++) {

                innerHtml = "<div class='col-xs-12 col-sm-6 col-md-4'> <div class='panel panel-default' id='algo_0'>" +
                        " <div class='panel-heading'>" + algos[i].strategyName + " " +
                        "<input type='checkbox' onClick='if (this.checked) $('#compareBtn').show(); else $('#compareBtn').hide();'> " +
                        "</div> <div class='panel-thumbnail'><div id='chartAsset_" + i + "' class='chartAsset'></div>" +

                        "</div> <div class='panel-body' onclick=\"loadAlgoDetail('" + algos[i].strategy + "')\"> <div class='row'> " +

                        "<div class='col-xs-6 col-md-6'> <span class='boldWords tooltipword' data-toggle='tooltip' title='Assets Calss' data-placement='left'>Assets Calss</span>" +
                        " </div> <div class='col-xs-6 col-md-6'> <span class='boldWords'>" + algos[i].StrategyType + " </span> </div> </div> <div class='row'>" +
                        " <div class='col-xs-6 col-md-6'> <span class='boldWords center'>Backtesting</span>" +
                        " </div> <div class='col-xs-6 col-md-6'> <span class='boldWords center'>L.T.D</span>" +
                        " </div> </div> <div class='row'> <div class='col-xs-4 col-md-4'> " +
                        "<span class='boldWords tooltipword' data-toggle='tooltip' title='Total Net Profit being adjusted to an annual basis which is an estimated total net profit for a full year' data-placement='bottom'>Annualized return</span> </div> <div class='col-xs-2 col-md-2'>" +
                        " <span class='boldWords'>" + roundNumberPercentage(algos[i].return_b, 2) + " </span> </div> <div class='col-xs-4 col-md-4'> " +
                        "<span class='boldWords tooltipword' data-toggle='tooltip' title='Total Net Profit being adjusted to an annual basis which is an estimated total net profit for a full year' data-placement='bottom'>Annualized return</span> </div> <div class='col-xs-2 col-md-2'> " +
                        "<span class='boldWords'>" + roundNumberPercentage(algos[i].return_ltd, 2) + "</span> </div> </div> <div class='row'> <div class='col-xs-4 col-md-4'> " +
                        "<span class='boldWords tooltipword' data-toggle='tooltip' title='  Maximum potential loss over a full year within the backtesting period which is the largest decline in value from the peak to the trough of accumulated payoff in a year in the backtesting period' data-placement='bottom'>Maximum drawdown</span>" +
                        " </div> <div class='col-xs-2 col-md-2'> " +
                        "<span class='boldWords'>" + roundNumberPercentage(algos[i].maxdrawdown_b, 2) + "</span> </div> <div class='col-xs-4 col-md-4'>" +
                        " <span class='boldWords tooltipword' data-toggle='tooltip' title='  Maximum potential loss over a full year within the backtesting period which is the largest decline in value from the peak to the trough of accumulated payoff in a year in the backtesting period' data-placement='bottom'>Maximum drawdown</span> </div> <div class='col-xs-2 col-md-2'>" +
                        " <span class='boldWords'>" + roundNumberPercentage(algos[i].maxdrawdown_ltd, 2) + "</span> </div> </div> <div class='row'> <div class='col-xs-4 col-md-4'> <span class='boldWords'>Sharpe ratio</span> </div> <div class='col-xs-2 col-md-2'> " +
                        "<span class='boldWords'>" + roundNumber(algos[i].sharperatio_b, 2) + "</span> </div> <div class='col-xs-4 col-md-4'> <span class='boldWords'>Sharpe ratio</span> </div> <div class='col-xs-2 col-md-2'> <span class='boldWords'>" + roundNumber(algos[i].sharperatio_ltd, 2) + "</span> </div> </div> <div class='row'> <div class='col-xs-6 col-md-6'> <span class='boldWords'>Launch Day</span> </div> <div class='col-xs-6 col-md-6'> <span class='boldWords'>" + algos[i].launchDate + "</span> </div> </div> <div class='row'> <div class='col-xs-6 col-md-6'> <span class='boldWords'>Price/Units</span> </div> <div class='col-xs-6 col-md-6'> " +
                        "<span class='boldWords'>" + algos[i].MoneyPerUnit + "(Total" + algos[i].MoneyMaxUnit + ")</span> </div> </div> <hr> <div class='row'>" +
                        " <div class='col-xs-6 col-md-6'> <span class='boldWords'>Status</span> </div> <div class='col-xs-6 col-md-6'> <span class='boldWords' id='unit_0'>" + algos[i].subscribeunit + "/" + algos[i].MaxUnit + "</span> </div> </div> </div> </div> </div> ";

//            quoteString = $(response.responseText).get(5).innerText;

                $("#algoList").append(innerHtml);


            }

            $('.tooltipword').tooltip();
            $.ajax({
                url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
                type: 'GET',
                data: { actionName: "getStrategyChartData", strategy: algos[0].strategy, type: "0", token: "H2XLW3KSN52R34M" },
                cache: false,
                dataType: "json",
                success: function (result) {

                    generateChart(result, "chartAsset_" + 0);
                }
            });
            $.ajax({
                url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
                type: 'GET',
                data: { actionName: "getStrategyChartData", strategy: algos[1].strategy, type: "0", token: "H2XLW3KSN52R34M" },
                cache: false,
                dataType: "json",
                success: function (result) {

                    generateChart(result, "chartAsset_" + 1);
                }
            });
            $.ajax({
                url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
                type: 'GET',
                data: { actionName: "getStrategyChartData", strategy: algos[2].strategy, type: "0", token: "H2XLW3KSN52R34M" },
                cache: false,
                dataType: "json",
                success: function (result) {

                    generateChart(result, "chartAsset_" + 2);
                }
            });
            $.ajax({
                url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
                type: 'GET',
                data: { actionName: "getStrategyChartData", strategy: algos[3].strategy, type: "0", token: "H2XLW3KSN52R34M" },
                cache: false,
                dataType: "json",
                success: function (result) {

                    generateChart(result, "chartAsset_" + 3);
                }
            });
//strategy


        }
    });


}


function generateChart(chartData, chartId) {
    var chart = AmCharts.makeChart(chartId, {
        "type": "serial",
        "theme": "dark",
        "pathToImages": "http://www.amcharts.com/lib/3/images/",
        "dataDateFormat": "YYYY-MM-DD",
        "marginBottom": 0,
        "marginLeft": 5,
        "marginRight": 5,
        "marginTop": 0,
        "dataProvider": chartData,
        "autoMarginOffset": 0,
        "marginBottom": 0,
        "valueAxes": [
            {
                "axisAlpha": 0.2,
                "dashLength": 1,
                "position": "left",
                "inside": true,
                "ignoreAxisWidth": true
            }
        ],
        "graphs": [
            {
                "id": "g1",
                "balloonText": "<span>[[d]]<br />Profit: [[n]]</span>",
                "bullet": "round",
                "bulletBorderAlpha": 1,
                "bulletColor": "#FFFFFF",
                "hideBulletsCount": 50,
                "title": "red line",
                "valueField": "n",
                "useLineColorForBulletBorder": true,
                "visibleInLegend": false
            }
        ],
        "chartScrollbar": {
            "autoGridCount": true,
            "graph": "g1",
            "scrollbarHeight": 20
        },
        "chartCursor": {
            "cursorPosition": "mouse",
            "autoWrap": false,
            "selectWithoutZooming": false,
            "categoryBalloonEnabled": false,
            "bulletsEnabled": true
        },
        "categoryField": "d",
        "categoryAxis": {
            "parseDates": true,
            "axisColor": "#DADADA",
            "dashLength": 1,
            "position": "top",
            "labelsEnabled": false,
            "labelFunction": formatValueLable
        },
        "exportConfig": {
            menuRight: '20px',
            menuBottom: '30px',
            menuItems: [
                {
                    icon: 'http://www.amcharts.com/lib/3/images/export.png',
                    format: 'png'
                }
            ]
        }
    });


}

function loadUserInfo() {


    $.ajax({
        url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
        type: 'GET',
        data: { actionName: "getUserInfo", un: window.sessionStorage.loginedAccount, token: "H2XLW3KSN52R34M" },
        cache: false,
        dataType: "json",
        success: function (result) {
            console.log("user info", result)
            $('#cashOnHand').html("$" + result[0].cashonhand);
            $('#pfCashOnHand').html("$" + result[0].cashonhand);
            $('#pfInvested').html("$" + result[0].totalHolding);
            $('#pfTHold').html("$" + result[0].totalProfit);


        }
    });
}

function unsubscribeAlgo(stg) {

    $.ajax({
        url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
        type: 'GET',
        data: { actionName: "unsubscribeAlgo", token: "H2XLW3KSN52R34M", strategyid: stg, account: window.sessionStorage.loginedAccount},
        cache: false,
        dataType: "json",
        success: function (result) {
            console.log(result);
            if (result[0].isSuccess == 1) {

                alert("Successfully unsubscribe algo !")

                var table = document.getElementById("pTable");

                for (var i = table.rows.length - 1; i > 0; i--) {
                    table.deleteRow(i);
                }


                loadUserPortfolio();
            }

        }
    });

}

function formatValueLable(value) {
    return value
}


function orderBy() {

    if ($('#pfmValue').html() == "Max.D.D") {
        category = 0;
    }
    else if ($('#pfmValue').html() == "A.Return") {
        category = 1;
    }
    else {
        category = 2;

    }


    if ($('#orderType').html() == "Descending") {
        orderby = 0;
    }
    else if ($('#orderType').html() == "Ascending") {
        orderby = 1;
    }

    if ($('#testType').html() == "BackTesting") {
        performanceType = 0;
    }
    else if ($('#testType').html() == "L.T.D") {
        performanceType = 1;
    }

    $("#algoList").html("");
    getAlgoList(category, orderby, performanceType);


    console.log(category);

    console.log(performanceType);
    console.log(orderby);


}


function roundNumber(number, decimals) {
    if (!parseFloat(number)) {
        return number;
    }
    var newString; // The new rounded number
    decimals = Number(decimals);
    if (decimals < 1) {
        newString = (Math.round(number)).toString();
    } else {
        var numString = number.toString();
        if (numString.lastIndexOf(".") == -1) {// If there is no decimal point
            numString += "."; // give it one at the end
        }
        var cutoff = numString.lastIndexOf(".") + decimals; // The point at which to truncate the number
        var d1 = Number(numString.substring(cutoff, cutoff + 1)); // The value of the last decimal place that we'll end up with
        var d2 = Number(numString.substring(cutoff + 1, cutoff + 2)); // The next decimal, after the last one we want
        if (d2 >= 5) {// Do we need to round up at all? If not, the string will just be truncated
            if (d1 == 9 && cutoff > 0) {// If the last digit is 9, find a new cutoff point
                while (cutoff > 0 && (d1 == 9 || isNaN(d1))) {
                    if (d1 != ".") {
                        cutoff -= 1;
                        d1 = Number(numString.substring(cutoff, cutoff + 1));
                    } else {
                        cutoff -= 1;
                    }
                }
            }
            d1 += 1;
        }
        if (d1 == 10) {
            numString = numString.substring(0, numString.lastIndexOf("."));
            var roundedNum = Number(numString) + 1;
            newString = roundedNum.toString() + '.';
        } else {
            newString = numString.substring(0, cutoff) + d1.toString();
        }
    }
    if (newString.lastIndexOf(".") == -1) {// Do this again, to the new string
        newString += ".";
    }
    var decs = (newString.substring(newString.lastIndexOf(".") + 1)).length;
    for (var i = 0; i < decimals - decs; i++) newString += "0";
    //var newNumber = Number(newString);// make it a number if you like
    return newString; // return the result to the form field (change for your purposes)
}

function roundNumberPercentage(number) {
    if (!parseFloat(number)) {
        return number;
    }
    return roundNumber(number * 100, 2) + "%";
}


function updatePflo() {
    var table = document.getElementById("pTable");

    for (var i = table.rows.length - 1; i > 0; i--) {
        table.deleteRow(i);
    }
//$('#pTable').remove();


    //console.log($("#pTable").text);

    //    myCreateFunction();

    $.ajax({
        url: "http://stockgame.cashsns.com/RADIUS/getData.aspx",
        type: 'GET',
        data: { actionName: "getAlgoStrategyAccountPerformance", token: "H2XLW3KSN52R34M", account: window.sessionStorage.loginedAccount },
        cache: false,
        dataType: "json",
        success: function (result) {

            console.log(result);


            for (i = 0; i < result.length; i++) {





                //onclick='unSubscribe('"+"PN012345"+",'"+pf[0]+"')'
                $('#pTable tr:last').after("<tr class=''><td >" + result[i].StrategyName + "</td><td >Futures</td><td >" + result[i].subscribeunit + "</td><td >" + result[i].RealizedProfit + "</td><td >" + result[i].UnrealizedProfit + "</td><td ><button class='btn'  aria-hidden='true' onclick=\"unsubscribeAlgo('" + result[i].Strategy + "')\" >Cancel</button></td></tr>");
                //   $('#pTable tr:last').after("<tr class=''><td >" + result[i].Strategy + "</td><td >香港恆生指數期貨</td><td >" + result[i].subscribeunit + "</td><td >" + result[i].RealizedProfit + "</td><td >" + result[i].UnrealizedProfit + "</td><td ><button class='btn'  aria-hidden='true' >Cancel</button></td></tr>");


            }
            //  console.log(quoteString);
            //   $('#Portfolio').modal('show');

        }
    });


}
//http://www.cashsns.com/Mobile_App_API_Algo/AlgoStrategyStatus.aspx?account=xxxx

</script>

</body>
</html>